document.addEventListener("dal-init-function",function(){yl.registerFunction("select2",function($,t){var e=$(t);function r(t,a){if(a){var e=$("<span>");return e.html(t),e}return t}function a(t){var a=r(t.text,void 0!==e.attr("data-html")||void 0!==e.attr("data-result-html"));return t.create_id?$("<span></span>").text(a).addClass("dal-create"):a}var n=null;e.attr("data-autocomplete-light-url")&&(n={url:e.attr("data-autocomplete-light-url"),dataType:"json",delay:250,data:function(t){return{q:t.term,page:t.page,create:e.attr("data-autocomplete-light-create")&&!e.attr("data-tags"),forward:yl.getForwards(e)}},processResults:function(t,a){return e.attr("data-tags")&&$.each(t.results,function(t,a){a.id=a.text}),t},cache:!0}),e.select2({tokenSeparators:e.attr("data-tags")?[","]:null,debug:!0,containerCssClass:":all:",placeholder:e.attr("data-placeholder")||"",language:e.attr("data-autocomplete-light-language"),minimumInputLength:e.attr("data-minimum-input-length")||0,allowClear:!e.is("[required]"),templateResult:a,templateSelection:function(t){return void 0!==t.selected_text?r(t.selected_text,void 0!==e.attr("data-html")||void 0!==e.attr("data-selected-html")):a(t)},ajax:n,with:null,tags:Boolean(e.attr("data-tags"))}),e.on("select2:selecting",function(t){var r,a=t.params.args.data;!0===a.create_id&&(t.preventDefault(),r=e,$.ajax({url:e.attr("data-autocomplete-light-url"),type:"POST",dataType:"json",data:{text:a.id,forward:yl.getForwards(e)},beforeSend:function(t,a){t.setRequestHeader("X-CSRFToken",document.csrftoken)},success:function(t,a,e){r.append($("<option>",{value:t.id,text:t.text,selected:!0})),r.trigger("change"),r.select2("close")}}))})})});