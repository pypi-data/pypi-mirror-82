(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[95],{1927:function(e,t,r){"use strict";var i=r(23),n=r.n(i).a.createActions(["fetch","showAllSimilarItems","toggleUnmerge","toggleMerge","unmerge","merge","toggleCollapseFingerprint","toggleCollapseFingerprints"]);t.a=n},1928:function(e,t,r){"use strict";var i=r(7),n=r.n(i),s=r(26),a=r.n(s),o=r(37),c=r.n(o),l=r(23),u=r.n(l),m=r(254),g=r.n(m),f=r(51),d=r(31),p=r(1927);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}var b=new f.a,j=u.a.createStore({listenables:[p.a],init:function(){var e=this,t=this.getInitialState();Object.entries(t).forEach((function(t){var r=c()(t,2),i=r[0],n=r[1];e[i]=n}))},getInitialState:function(){return{mergedItems:[],unmergeList:new Map,unmergeState:new Map,unmergeDisabled:!0,unmergeLastCollapsed:!1,enableFingerprintCompare:!1,similarItems:[],filteredSimilarItems:[],similarLinks:"",mergeState:new Map,mergeList:new Set,mergedLinks:"",mergeDisabled:!1,loading:!0,error:!1}},setStateForId:function(e,t,r){return(Array.isArray(t)?t:[t]).map((function(t){var i=e.has(t)&&e.get(t)||{},n=Object.assign({},i,r);return e.set(t,n),n}))},isAllUnmergedSelected:function(){var e=Array.from(this.unmergeState.values()).filter((function(e){return e.busy}))||[];return this.unmergeList.size===this.mergedItems.filter((function(e){return!!e.latestEvent})).length-e.length},onFetch:function(e){var t=this,r=e||this.toFetchArray;this.init(),this.triggerFetchState();var i=r.map((function(e){var t=e.endpoint,r=e.queryParams,i=e.dataKey;return new Promise((function(e,n){b.request(t,{method:"GET",data:r,success:function(t,r,n){e({dataKey:i,data:t,links:n.getResponseHeader("Link")})},error:function(e){var t=e.responseJSON&&e.responseJSON.detail||!0;n(t)}})}))})),n={merged:function(e){return t.setStateForId(t.unmergeState,e.id,{busy:"locked"===e.state}),e},similar:function(e){var t,r=c()(e,2),i=r[0],n=r[1],s=!((t=n)&&Object.keys(t)||[]).map((function(e){return t[e]})).find((function(e){return e>=.6})),a=Object.keys(n).map((function(e){return[e,n[e]]})).reduce((function(e,t){var r=c()(t,2),i=r[0],n=r[1],s=i.split(":"),a=c()(s,1)[0];return e[a]||(e[a]=[]),e[a].push([i,n]),e}),{}),o=Object.keys(a).map((function(e){return[e,a[e]]})).reduce((function(e,t){var r=c()(t,2),i=r[0],n=r[1].filter((function(e){return null!==c()(e,2)[1]})),s=n.reduce((function(e,t){return e+c()(t,2)[1]}),0)/n.length;return e[i]=s,e}),{});return{issue:i,score:n,scoresByInterface:a,aggregate:o,isBelowThreshold:s}}};return e&&(this.toFetchArray=e),Promise.all(i).then((function(e){e.forEach((function(e){var r=e.dataKey,i=e.data,s=e.links,a=i.map(n[r]);t["".concat(r,"Items")]=a,t["".concat(r,"Links")]=s})),t.loading=!1,t.error=!1,t.triggerFetchState()}),(function(){t.loading=!1,t.error=!0,t.triggerFetchState()}))},onToggleMerge:function(e){var t,r=this.mergeState.has(e)&&this.mergeState.get(e);r&&!0===r.busy||(this.mergeList.has(e)?(this.mergeList.delete(e),t=!1):(this.mergeList.add(e),t=!0),this.setStateForId(this.mergeState,e,{checked:t}),this.triggerMergeState())},onToggleUnmerge:function(e){var t,r=c()(e,2),i=r[0],n=r[1],s=this.unmergeState.get(i);s&&!0===s.busy||(this.unmergeList.has(i)?(this.unmergeList.delete(i),t=!1):(this.unmergeList.set(i,n),t=!0),this.setStateForId(this.unmergeState,i,{checked:t}),this.unmergeDisabled=0===this.unmergeList.size||this.isAllUnmergedSelected(),this.enableFingerprintCompare=2===this.unmergeList.size,this.triggerUnmergeState())},onUnmerge:function(e){var t=this,r=e.groupId,i=e.loadingMessage,n=e.successMessage,s=e.errorMessage,a=Array.from(this.unmergeList.keys());return new Promise((function(e,o){t.isAllUnmergedSelected()?o(new Error("Not allowed to unmerge ALL events")):(t.unmergeDisabled=!0,t.setStateForId(t.unmergeState,a,{checked:!1,busy:!0}),t.triggerUnmergeState(),Object(d.b)(i),b.request("/issues/".concat(r,"/hashes/"),{method:"DELETE",query:{id:a},success:function(){Object(d.d)(n),t.setStateForId(t.unmergeState,a,{checked:!1,busy:!0}),t.unmergeList.clear()},error:function(){Object(d.a)(s),t.setStateForId(t.unmergeState,a,{checked:!0,busy:!1})},complete:function(){t.unmergeDisabled=!1,e(t.triggerUnmergeState())}}))}))},onMerge:function(e){var t=this,r=e.params,i=e.query,n=e.projectId,s=Array.from(this.mergeList.values());return this.mergeDisabled=!0,this.setStateForId(this.mergeState,s,{busy:!0}),this.triggerMergeState(),new Promise((function(e){if(r){var o=r.orgId,c=r.groupId;b.merge({orgId:o,projectId:n||r.projectId,itemIds:[].concat(a()(s),[c]),query:i},{success:function(e){e&&e.merge&&e.merge.parent&&t.trigger({mergedParent:e.merge.parent}),t.setStateForId(t.mergeState,s,{checked:!1,busy:!0}),t.mergeList.clear()},error:function(){t.setStateForId(t.mergeState,s,{checked:!0,busy:!1})},complete:function(){t.mergeDisabled=!1,e(t.triggerMergeState())}})}else e(null)}))},onToggleCollapseFingerprints:function(){this.setStateForId(this.unmergeState,this.mergedItems.map((function(e){return e.id})),{collapsed:!this.unmergeLastCollapsed}),this.unmergeLastCollapsed=!this.unmergeLastCollapsed,this.trigger({unmergeLastCollapsed:this.unmergeLastCollapsed,unmergeState:this.unmergeState})},onToggleCollapseFingerprint:function(e){var t=this.unmergeState.has(e)&&this.unmergeState.get(e).collapsed;this.setStateForId(this.unmergeState,e,{collapsed:!t}),this.trigger({unmergeState:this.unmergeState})},triggerFetchState:function(){var e=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){n()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({similarItems:this.similarItems.filter((function(e){return!e.isBelowThreshold})),filteredSimilarItems:this.similarItems.filter((function(e){return e.isBelowThreshold}))},g()(this,["mergedItems","mergedLinks","similarLinks","mergeState","unmergeState","loading","error"]));return this.trigger(e),e},triggerUnmergeState:function(){var e=g()(this,["unmergeDisabled","unmergeState","unmergeList","enableFingerprintCompare","unmergeLastCollapsed"]);return this.trigger(e),e},triggerMergeState:function(){var e=g()(this,["mergeDisabled","mergeState","mergeList"]);return this.trigger(e),e}});t.a=j},2049:function(e,t,r){"use strict";var i=r(4),n=r(2),s=r.n(n),a=Object(i.a)("div",{target:"e1uibv5p0",label:"FlowLayout"})("display:flex;flex:1;align-items:center;flex-direction:",(function(e){return e.vertical?"column":null}),";justify-content:",(function(e){return e.center?"center":null}),";overflow:",(function(e){return e.truncate?"hidden":null}),";");a.propTypes={center:s.a.bool,vertical:s.a.bool,truncate:s.a.bool},a.defaultProps={truncate:!0},t.a=a},2050:function(e,t,r){"use strict";var i=r(5),n=r.n(i),s=r(15),a=r.n(s),o=(r(1),r(38)),c=r.n(o),l=r(0),u=function(e){var t=e.responsive,r=void 0!==t&&t,i=e.center,s=void 0===i||i,o=e.children,u=e.className,m=a()(e,["responsive","center","children","className"]),g=c()("spread-layout",u,{center:s,"allow-responsive":r});return Object(l.f)("div",n()({},m,{className:g}),o)};u.displayName="SpreadLayout",t.a=u},2149:function(e,t,r){"use strict";var i=r(4),n=Object(i.a)("div",{target:"e1pdx9kr0",label:"Toolbar"})("background:",(function(e){return e.theme.gray100}),";border:1px solid ",(function(e){return e.theme.borderLight}),";border-bottom:none;border-radius:3px 3px 0 0;box-shadow:0 1px 0 ",(function(e){return e.theme.borderLight}),";margin:0;");t.a=n},2938:function(e,t,r){"use strict";r.r(t);var i=r(5),n=r.n(i),s=r(15),a=r.n(s),o=r(1),c=r.n(o),l=r(140),u=r(37),m=r.n(u),g=r(7),f=r.n(g),d=r(4),p=r(8),h=r(23),b=r.n(h),j=r(32),O=r.n(j),y=r(88),v=r(3),S=r(9),I=r(1927),w=r(1928),k=r(184),L=r(47),x=r(164),N=r(30),P=r(10),C=r.n(P),D=r(11),F=r.n(D),M=r(12),A=r.n(M),E=r(13),T=r.n(E),U=r(6),q=r.n(U),z=r(618),G=r(0);function R(e){var t=e.className;return Object(G.f)("div",{className:t},Object(G.f)("span",null,Object(v.b)("Similar")),Object(G.f)(V,{colorIndex:4}),Object(G.f)(V,{colorIndex:3}),Object(G.f)(V,{colorIndex:2}),Object(G.f)(V,{colorIndex:1}),Object(G.f)(V,{colorIndex:0}),Object(G.f)("span",null,Object(v.b)("Not Similar")))}R.displayName="SimilarSpectrum";var W=Object(d.a)(R,{target:"enx6bph0",label:"StyledSimilarSpectrum"})("display:flex;font-size:",(function(e){return e.theme.fontSizeSmall}),";"),V=Object(d.a)("span",{target:"enx6bph1",label:"SpectrumItem"})("border-radius:2px;margin:5px;width:14px;",(function(e){return"background-color: ".concat(e.theme.similarity.colors[e.colorIndex],";")}),";"),B=W,H=r(281),J=r(199),K=r(38),Q=r.n(K),X=r(96),Y=r(287),Z=r(174),$=r(921),_=r(661),ee=r(2049),te=r(331),re=r(676),ie={"exception:message:character-shingles":Object(v.b)("Exception Message"),"exception:stacktrace:application-chunks":Object(v.b)("Application Code"),"exception:stacktrace:pairs":Object(v.b)("Stacktrace Frames"),"message:message:character-shingles":Object(v.b)("Log Message")},ne=function(e){var t=e.scoreList,r=void 0===t?[]:t;return 0===r.length?null:Object(G.f)("div",null,r.map((function(e){var t=m()(e,2),r=t[0],i=t[1];return Object(G.f)(se,{key:r},Object(G.f)("div",null,ie[r]),Object(G.f)(ae,{score:null===i?i:Math.round(5*i)}))})))};ne.displayName="SimilarScoreCard";var se=Object(d.a)("div",{target:"e1vycly80",label:"Wrapper"})("display:flex;justify-content:space-between;margin:",Object(S.a)(.25)," 0;"),ae=Object(d.a)("div",{target:"e1vycly81",label:"Score"})("height:16px;width:48px;border-radius:2px;background-color:",(function(e){return null===e.score?e.theme.similarity.empty:e.theme.similarity.colors[e.score]}),";"),oe=ne,ce=r(2050);function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var me=["exception","message"],ge=O()({displayName:"SimilarIssueItem",mixins:[b.a.listenTo(w.a,"onGroupingUpdate")],getInitialState:function(){return{visible:!0,checked:!1,busy:!1}},onGroupingUpdate:function(e){var t=this,r=e.mergeState,i=this.props.issue;if(r){var n=r.has(i.id)&&r.get(i.id);n&&Object.keys(n).forEach((function(e){n[e]!==t.state[e]&&t.setState(f()({},e,n[e]))}))}},handleToggle:function(){var e=this.props.issue;this.state.busy||I.a.toggleMerge(e.id)},handleShowDiff:function(e){var t=this.props,r=t.orgId,i=t.groupId,n=t.issue,s=t.project;Object(X.f)({baseIssueId:i,targetIssueId:n.id,project:s,orgId:r}),e.stopPropagation()},handleCheckClick:function(){},render:function(){var e=this.props,t=e.aggregate,r=e.scoresByInterface,i=e.issue;if(!this.state.visible)return null;var n=Q()("group","similar-issue",{isResolved:"resolved"===i.status,busy:this.state.busy});return Object(G.f)(ce.a,{"data-test-id":"similar-item-row",className:n,responsive:!0,onClick:this.handleToggle},Object(G.f)(ee.a,{truncate:!0},Object(G.f)(ee.a,{truncate:!0},Object(G.f)("div",{className:"action-column"},Object(G.f)(Y.a,{id:i.id,value:i.id,checked:this.state.checked,onChange:this.handleCheckClick})),Object(G.f)("div",{className:"event-details",style:{flex:1}},Object(G.f)(_.a,{data:i}),Object(G.f)($.a,{data:ue({},i,{lastSeen:null}),showAssignee:!0}))),Object(G.f)("button",{style:{marginRight:2},className:"btn btn-default btn-xs",onClick:this.handleShowDiff},"Diff")),Object(G.f)("div",{className:"similar-score-columns"},Object(G.f)(Z.a,{className:"similar-score-column",value:i.count}),me.map((function(e){var i=t[e],n=r[e]||[],s="number"!=typeof i||Number.isNaN(i)?0:i;return Object(G.f)("div",{key:e,className:"similar-score-column"},Object(G.f)(te.b,{body:n.length&&Object(G.f)(oe,{scoreList:n})},Object(G.f)(re.a,{vertical:!0,score:Math.round(5*s)})))}))))}}),fe=r(639),de=r(2149),pe=r(479),he=O()({displayName:"SimilarToolbar",mixins:[b.a.listenTo(w.a,"onGroupingUpdate")],getInitialState:function(){return{mergeCount:0}},onGroupingUpdate:function(e){var t=e.mergeList;t&&t.size!==this.state.mergedCount&&this.setState({mergeCount:t.size})},render:function(){var e=this.props.onMerge;return Object(G.f)(de.a,{className:"similar-toolbar"},Object(G.f)(ce.a,{responsive:!0},Object(G.f)(ee.a,{style:{flex:1}},Object(G.f)(ee.a,null,Object(G.f)("div",{className:"similar-toolbar-actions"},Object(G.f)(fe.a,{"data-test-id":"merge",disabled:0===this.state.mergeCount,title:Object(v.b)("Merging ".concat(this.state.mergeCount," issues")),message:Object(v.b)("Are you sure you want to merge these issues?"),className:"btn btn-sm btn-default",onConfirm:e},Object(v.b)("Merge")," (",this.state.mergeCount||0,")")))),Object(G.f)("div",{className:"similar-score-columns"},Object(G.f)(pe.a,{className:"similar-score-column event-count-header"},Object(v.b)("Events")),Object(G.f)(pe.a,{className:"similar-score-column event-similar-header"},Object(v.b)("Exception")),Object(G.f)(pe.a,{className:"similar-score-column event-similar-header"},Object(v.b)("Message")))))}});function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=q()(e);if(t){var n=q()(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return T()(this,r)}}var je=function(e){A()(r,e);var t=be(r);function r(){var e;C()(this,r);for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).renderEmpty=function(){return Object(G.f)(J.a,null,Object(G.f)(J.c,null,Object(G.f)(H.a,{small:!0,withIcon:!1},Object(v.b)("No issues with a similar stack trace have been found."))))},e.handleShowAll=function(){e.setState({showAllItems:!0})},e.state={showAllItems:!1},e}return F()(r,[{key:"render",value:function(){var e=this.props,t=e.orgId,r=e.groupId,i=e.project,s=e.items,a=e.filteredItems,o=e.pageLinks,c=e.onMerge,l=!!a.length,u=s.length>0||l,m=s.concat(this.state.showAllItems&&a||[]);return u?Object(G.f)(ye,{className:"similar-list-container"},Object(G.f)(ve,null,Object(G.f)(B,null)),Object(G.f)(he,{onMerge:c}),Object(G.f)("div",{className:"similar-list"},m.map((function(e){return Object(G.f)(ge,n()({key:e.issue.id,orgId:t,groupId:r,project:i},e))})),l&&!this.state.showAllItems&&Object(G.f)("div",{className:"similar-items-footer"},Object(G.f)("button",{className:"btn btn-default btn-xl",onClick:this.handleShowAll},"Show ",a.length," issues below threshold"))),Object(G.f)(z.a,{pageLinks:o})):this.renderEmpty()}}]),r}(c.a.Component);je.displayName="List",je.defaultProps={filteredItems:[]};var Oe=je,ye=Object(d.a)("div",{target:"e13x2p390",label:"Wrapper"})("margin-bottom:",Object(S.a)(2),";"),ve=Object(d.a)("div",{target:"e13x2p391",label:"Header"})("display:flex;justify-content:flex-end;margin-bottom:",Object(S.a)(1),";");function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(r),!0).forEach((function(t){f()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var we=O()({displayName:"GroupGroupingView",mixins:[b.a.listenTo(w.a,"onGroupingUpdate")],getInitialState:function(){return{similarItems:[],filteredSimilarItems:[],similarLinks:[],loading:!0,error:!1,v2:!1}},componentWillMount:function(){this.fetchData()},componentWillReceiveProps:function(e){e.params.groupId===this.props.params.groupId&&e.location.search===this.props.location.search||this.fetchData()},onGroupingUpdate:function(e){var t=e.mergedParent,r=e.similarItems,i=e.similarLinks,n=e.filteredSimilarItems,s=e.loading,a=e.error;if(r)this.setState({similarItems:r,similarLinks:i,filteredSimilarItems:n,loading:void 0!==s&&s,error:void 0!==a&&a});else if(t&&t!==this.props.params.groupId){var o=this.props.params;p.browserHistory.push("/organizations/".concat(o.orgId,"/issues/").concat(t,"/similar/"))}},getEndpoint:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"similar",t=this.props.params,r=Ie({},this.props.location.query,{limit:50,version:this.state.v2?"2":"1"});return"/issues/".concat(t.groupId,"/").concat(e,"/?").concat(y.stringify(r))},hasSimilarityFeature:function(){return new Set(this.props.project.features).has("similarity-view")},hasSimilarityV2Feature:function(){return new Set(this.props.project.features).has("similarity-view-v2")},fetchData:function(){this.setState({loading:!0,error:!1});var e=[];this.hasSimilarityFeature()&&e.push({endpoint:this.getEndpoint("similar"),dataKey:"similar"}),I.a.fetch(e)},toggleSimilarityVersion:function(){this.setState({v2:!this.state.v2},this.fetchData)},handleMerge:function(){var e=this.props.params,t=this.props.location.query;if(e){var r=this.state.similarItems.length?this.state.similarItems:this.state.filteredSimilarItems,i=m()(r,1)[0];I.a.merge({params:e,query:t,projectId:i.issue.project.slug})}},render:function(){var e=this.props,t=e.params,r=t.orgId,i=t.groupId,n=e.project,s=this.hasSimilarityV2Feature(),a=this.state.loading,o=this.state.error&&!a,c=!o&&!a,l=this.hasSimilarityFeature()&&(this.state.similarItems.length>=0||this.state.filteredSimilarItems.length>=0)&&c;return Object(G.f)("div",null,Object(G.f)("div",{className:"alert alert-block alert-warning"},Object(G.f)("strong",null,Object(v.b)("Warning"),":")," ",Object(v.b)("This is an experimental feature. Data may not be immediately available while we process merges.")),Object(G.f)(Le,null,Object(G.f)(ke,null,Object(v.b)("Issues with a similar stack trace")),s&&Object(G.f)(x.a,{merged:!0,active:this.state.v2?"new":"old"},Object(G.f)(N.a,{barId:"old",size:"small",onClick:this.toggleSimilarityVersion},Object(v.b)("Old Algorithm")),Object(G.f)(N.a,{barId:"new",size:"small",onClick:this.toggleSimilarityVersion},Object(v.b)("New Algorithm")))),a&&Object(G.f)(L.default,null),o&&Object(G.f)(k.a,{message:"Unable to load similar issues, please try again later",onRetry:this.fetchData}),l&&Object(G.f)(Oe,{items:this.state.similarItems,filteredItems:this.state.filteredSimilarItems,onMerge:this.handleMerge,orgId:r,project:n,groupId:i,pageLinks:this.state.similarLinks}))}}),ke=Object(d.a)("h4",{target:"ep472fu0",label:"Title"})({name:"gx0lhm",styles:"margin-bottom:0;"}),Le=Object(d.a)("div",{target:"ep472fu1",label:"HeaderWrapper"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",Object(S.a)(2),";"),xe=function(e){var t=e.location,r=e.project,i=e.group,s=a()(e,["location","project","group"]);return Object(G.f)(l.a,{features:["similarity-view"],project:r},Object(G.f)(we,n()({project:r,location:t,group:i,query:t.query},s)))};xe.displayName="GroupSimilarIssues";t.default=xe}}]);
//# sourceMappingURL=GroupSimilarIssues.js.map