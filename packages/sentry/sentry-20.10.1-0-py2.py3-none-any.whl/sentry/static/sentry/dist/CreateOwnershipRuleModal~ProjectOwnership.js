(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[19],{2382:function(e,t,n){"use strict";var a=n(10),r=n.n(a),i=n(11),o=n.n(i),l=n(12),c=n.n(l),s=n(13),u=n.n(s),p=n(6),d=n.n(p),f=n(4),h=n(1),b=n.n(h),g=n(1837),m=n.n(g),O=n(51),j=n(145),y=n(125),v=n(30),x=n(31),w=n(3),C=n(621),S=n(156),k=n(252),T=n(18),R=n(378),U=n(21),M=n.n(U),P=n(28),z=n.n(P),A=n(26),I=n.n(A),D=n(7),N=n.n(D),V=n(19),B=n.n(V),q=n(148),L=n.n(q),W=n(39),E=n.n(W),J=n(23),K=n.n(J),F=n(384),H=n(27),Y=n(286),_=n(283),G=n(5),Q=n.n(G),X=n(165),Z=n(0),$=b.a.forwardRef((function(e,t){return Object(Z.f)(X.a,Q()({forwardedRef:t},e,{multiple:!0}))})),ee=n(660),te=n(33);function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){N()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ie=function(e){c()(n,e);var t=re(n);function n(){var e;r()(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleClick=function(){e.props.onRemove(e.props.value)},e}return o()(n,[{key:"render",value:function(){return Object(Z.f)("a",{onClick:this.handleClick},Object(Z.f)(ee.a,{actor:this.props.value.actor,size:28}))}}]),n}(b.a.Component);ie.displayName="ValueComponent";var oe=function(e){return"".concat(e.email&&e.email.toLowerCase()," ").concat(e.name&&e.name.toLowerCase())},le={name:"fs1hps-SelectOwners",styles:"width:200px;;label:SelectOwners;"},ce=function(e){c()(a,e);var t,n=re(a);function a(){var e;r()(this,a);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).state={loading:!1,inputValue:""},e.renderUserBadge=function(e){return Object(Z.f)(_.a,{avatarSize:24,user:e,hideEmail:!0,useLink:!1})},e.createMentionableUser=function(t){return{value:Object(H.b)(t.id),label:e.renderUserBadge(t),searchKey:oe(t),actor:{type:"user",id:t.id,name:t.name}}},e.createUnmentionableUser=function(t){var n=t.user;return ae({},e.createMentionableUser(n),{disabled:!0,label:Object(Z.f)(ue,null,Object(Z.f)(te.a,{position:"left",title:Object(w.b)("%s is not a member of project",n.name||n.email)},e.renderUserBadge(n)))})},e.createMentionableTeam=function(e){return{value:Object(H.a)(e.id),label:Object(Z.f)(_.a,{team:e}),searchKey:"#".concat(e.slug),actor:{type:"team",id:e.id,name:e.slug}}},e.createUnmentionableTeam=function(t){var n=e.props.organization.access.includes("project:write");return ae({},e.createMentionableTeam(t),{disabled:!0,label:Object(Z.f)(se,null,Object(Z.f)(ue,null,Object(Z.f)(te.a,{position:"left",title:Object(w.b)("%s is not a member of project","#".concat(t.slug))},Object(Z.f)(_.a,{team:t}))),Object(Z.f)(te.a,{title:n?Object(w.b)("Add %s to project","#".concat(t.slug)):Object(w.b)("You do not have permission to add team to project.")},Object(Z.f)(pe,{size:"zero",borderless:!0,disabled:!n,onClick:e.handleAddTeamToProject.bind(B()(e),t),icon:Object(Z.f)(T.b,{isCircled:!0})})))})},e.handleChange=function(t){e.props.onChange(t)},e.handleInputChange=function(t){e.setState({inputValue:t}),e.props.onInputChange&&e.props.onInputChange(t)},e.queryMembers=L()((function(t,n){var a=e.props.organization;return e.api?e.api.requestPromise("/organizations/".concat(a.slug,"/members/"),{query:{query:t}}).then((function(e){return n(null,e)}),(function(e){return n(e)})):null}),250),e.handleLoadOptions=function(){var t=e.getMentionableUsers(),n=e.getMentionableTeams(),a=e.getTeamsNotInProject(n),r=t.map((function(e){return e.actor.id}));return new Promise((function(t,n){e.queryMembers(e.state.inputValue,(function(e,a){e?n(e):t(a)}))})).then((function(t){return t?t.filter((function(e){var t=e.user;return t&&-1===r.indexOf(t.id)})).map(e.createUnmentionableUser):[]})).then((function(e){return{options:[].concat(I()(t),I()(n),I()(a),I()(e))}}))},e.api=new O.a,e.projectsStoreMixin=K.a.listenTo(y.a,(function(){e.closeSelectMenu()})),e}return o()(a,[{key:"componentDidMount",value:function(){this.projectsStoreMixin&&this.projectsStoreMixin.componentDidMount()}},{key:"componentWillUnmount",value:function(){this.api=null,this.projectsStoreMixin&&this.projectsStoreMixin.componentWillUnmount()}},{key:"getMentionableUsers",value:function(){return j.a.getAll().map(this.createMentionableUser)}},{key:"getMentionableTeams",value:function(){var e=this.props.project,t=y.a.getBySlug(e.slug);return t?t.teams.map(this.createMentionableTeam):[]}},{key:"getTeamsNotInProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=Y.a.getAll()||[],n=e.map((function(e){return e.actor.id}));return t.filter((function(e){return-1===n.indexOf(e.id)})).map(this.createUnmentionableTeam)}},{key:"closeSelectMenu",value:function(){if(this.selectRef){var e=E.a.findDOMNode(this.selectRef).querySelector(".Select-input input");e&&e.blur()}}},{key:"handleAddTeamToProject",value:(t=z()(M.a.mark((function e(t){var n,a,r,i,o;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,a=n.organization,r=n.project,i=n.value,o=I()(i),this.props.onChange([].concat(I()(this.props.value),[this.createMentionableTeam(t)])),e.prev=3,e.next=6,Object(F.a)(this.api,a.slug,r.slug,t);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),this.props.onChange(o),this.closeSelectMenu();case 12:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return Object(Z.f)($,{deprecatedSelectControl:!0,filterOptions:function(e,t){return e.filter((function(e){return e.searchKey.indexOf(t)>-1}))},ref:function(t){return e.selectRef=t},loadOptions:this.handleLoadOptions,defaultOptions:!0,async:!0,clearable:!0,disabled:this.props.disabled,cache:!1,valueComponent:ie,placeholder:Object(w.b)("owners"),onInputChange:this.handleInputChange,onChange:this.handleChange,value:this.props.value,css:le})}}]),a}(b.a.Component);ce.displayName="SelectOwners";var se=Object(f.a)("div",{target:"ez8xng90",label:"Container"})({name:"gg4vpm",styles:"display:flex;justify-content:space-between;"}),ue=Object(f.a)("div",{target:"ez8xng91",label:"DisabledLabel"})({name:"1bjwb34",styles:"opacity:0.5;overflow:hidden;"}),pe=Object(f.a)(v.a,{target:"ez8xng92",label:"AddToProjectButton"})({name:"6su6fj",styles:"flex-shrink:0;"}),de=n(9);function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var he={text:"",tagName:"",type:"path",owners:[],isValid:!1};function be(e){switch(e){case"path":return"src/example/*";case"url":return"https://example.com/settings/*";case"tag":return"tag-value";default:return""}}var ge=function(e){c()(n,e);var t=fe(n);function n(e){var a;return r()(this,n),(a=t.call(this,e)).checkIsValid=function(){a.setState((function(e){return{isValid:!!e.text&&e.owners&&!!e.owners.length}}))},a.handleTypeChange=function(e){a.setState({type:e}),a.checkIsValid()},a.handleTagNameChangeValue=function(e){a.setState({tagName:e.target.value},a.checkIsValid)},a.handleChangeValue=function(e){a.setState({text:e.target.value}),a.checkIsValid()},a.handleChangeOwners=function(e){a.setState({owners:e}),a.checkIsValid()},a.handleAddRule=function(){var e=a.state,t=e.type,n=e.text,r=e.tagName,i=e.owners;if(e.isValid){var o=i.map((function(e){return"team"===e.actor.type?"#".concat(e.actor.name):j.a.getById(e.actor.id).email})).join(" "),l=n.match(/\s/)?'"'.concat(n,'"'):n,c="".concat("tag"===t?"tags.".concat(r):t,":").concat(l," ").concat(o);a.props.onAddRule(c),a.setState(he)}else Object(x.a)("A rule needs a type, a value, and one or more issue owners.")},a.handleSelectCandidate=function(e,t){a.setState({text:e,type:t}),a.checkIsValid()},a.state=he,a}return o()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.urls,a=t.paths,r=t.disabled,i=t.project,o=t.organization,l=this.state,c=l.type,s=l.text,u=l.tagName,p=l.owners,d=l.isValid;return Object(Z.f)(b.a.Fragment,null,(a||n)&&Object(Z.f)(me,null,a&&a.map((function(t){return Object(Z.f)(ye,{key:t,onClick:function(){return e.handleSelectCandidate(t,"path")}},Object(Z.f)(ve,{isCircled:!0}),Object(Z.f)(je,null,t),Object(Z.f)(Oe,null,"[PATH]"))})),n&&n.map((function(t){return Object(Z.f)(ye,{key:t,onClick:function(){return e.handleSelectCandidate(t,"url")}},Object(Z.f)(ve,{isCircled:!0}),Object(Z.f)(je,null,t),Object(Z.f)(Oe,null,"[URL]"))}))),Object(Z.f)(xe,null,Object(Z.f)(we,{deprecatedSelectControl:!0,name:"select-type",value:c,showSearch:!1,onChange:this.handleTypeChange,options:[{value:"path",label:Object(w.b)("Path")},{value:"tag",label:Object(w.b)("Tag")},{value:"url",label:Object(w.b)("URL")}],style:{width:140},clearable:!1,disabled:r}),"tag"===c&&Object(Z.f)(Se,{controlled:!0,value:u,onChange:this.handleTagNameChangeValue,disabled:r,placeholder:"tag-name"}),Object(Z.f)(Ce,{controlled:!0,value:s,onChange:this.handleChangeValue,disabled:r,placeholder:be(c)}),Object(Z.f)(ke,{direction:"right"}),Object(Z.f)(Te,null,Object(Z.f)(ce,{organization:o,project:i,value:p,onChange:this.handleChangeOwners,disabled:r})),Object(Z.f)(Re,{priority:"primary",disabled:!d,onClick:this.handleAddRule,icon:Object(Z.f)(T.b,{size:"xs",isCircled:!0}),size:"small"})))}}]),n}(b.a.Component);ge.displayName="RuleBuilder";var me=Object(f.a)("div",{target:"e1hyuoc70",label:"Candidates"})({name:"1r2f04i",styles:"margin-bottom:10px;"}),Oe=Object(f.a)("div",{target:"e1hyuoc71",label:"TypeHint"})("color:",(function(e){return e.theme.borderDark}),";"),je=Object(f.a)(k.b,{target:"e1hyuoc72",label:"StyledTextOverflow"})({name:"1rr4qq7",styles:"flex:1;"}),ye=Object(f.a)("div",{target:"e1hyuoc73",label:"RuleCandidate"})("font-family:",(function(e){return e.theme.text.familyMono}),";border:1px solid ",(function(e){return e.theme.borderDark}),";background-color:#f8fafd;padding-left:5px;margin-bottom:3px;cursor:pointer;overflow:hidden;display:flex;align-items:center;"),ve=Object(f.a)(T.b,{target:"e1hyuoc74",label:"StyledIconAdd"})("color:",(function(e){return e.theme.borderDark}),";margin-right:5px;flex-shrink:0;"),xe=Object(f.a)("div",{target:"e1hyuoc75",label:"BuilderBar"})("display:flex;height:40px;align-items:center;margin-bottom:",Object(de.a)(2),";"),we=Object(f.a)(S.a,{target:"e1hyuoc76",label:"BuilderSelect"})("margin-right:",Object(de.a)(1.5),";width:50px;flex-shrink:0;"),Ce=Object(f.a)(R.a,{target:"e1hyuoc77",label:"BuilderInput"})("padding:",Object(de.a)(1),";line-height:19px;margin-right:",Object(de.a)(.5),";"),Se=Object(f.a)(R.a,{target:"e1hyuoc78",label:"BuilderTagNameInput"})("padding:",Object(de.a)(1),";line-height:19px;margin-right:",Object(de.a)(.5),";width:200px;"),ke=Object(f.a)(T.j,{target:"e1hyuoc79",label:"Divider"})("color:",(function(e){return e.theme.borderDark}),";flex-shrink:0;margin-right:5px;"),Te=Object(f.a)("div",{target:"e1hyuoc710",label:"SelectOwnersWrapper"})("display:flex;align-items:center;margin-right:",Object(de.a)(1),";"),Re=Object(f.a)(v.a,{target:"e1hyuoc711",label:"AddButton"})("padding:",Object(de.a)(.5),";"),Ue=ge;function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Pe=function(e){c()(n,e);var t=Me(n);function n(e){var a;return r()(this,n),(a=t.call(this,e)).handleUpdateOwnership=function(){var e=a.props,t=e.organization,n=e.project,r=a.state.text;a.setState({error:null});var i=(new O.a).requestPromise("/projects/".concat(t.slug,"/").concat(n.slug,"/ownership/"),{method:"PUT",data:{raw:r||""}});return i.then((function(){Object(x.d)(Object(w.b)("Updated issue ownership rules")),a.setState({initialText:r})})).catch((function(e){a.setState({error:e.responseJSON}),403===e.status?Object(x.a)(Object(w.b)("You don't have permission to modify issue ownership rules for this project")):400===e.status&&e.responseJSON.raw&&e.responseJSON.raw[0].startsWith("Invalid rule owners:")?Object(x.a)(Object(w.b)("Unable to save issue ownership rule changes: "+e.responseJSON.raw[0])):Object(x.a)(Object(w.b)("Unable to save issue ownership rule changes"))})),i},a.handleChange=function(e){a.setState({text:e.target.value})},a.handleAddRule=function(e){a.setState((function(t){return{text:t.text+"\n"+e}}),a.handleUpdateOwnership)},a.state={text:e.initialText,initialText:e.initialText,error:null},a}return o()(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.initialText;t!==this.state.initialText&&this.setState({initialText:t})}},{key:"parseError",value:function(e){var t=e&&e.raw&&e.raw[0];return t?t.startsWith("Invalid rule owners:")?Object(Z.f)(Ne,null,t):Object(Z.f)(Ae,{line:t.match(/line (\d*),/)[1]-1}):null}},{key:"mentionableUsers",value:function(){return j.a.getAll().map((function(e){return{id:e.id,display:e.email,email:e.email}}))}},{key:"mentionableTeams",value:function(){var e=this.props.project;return(y.a.getBySlug(e.slug)||{teams:[]}).teams.map((function(e){return{id:e.id,display:"#".concat(e.slug),email:e.id}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.project,a=t.organization,r=t.disabled,i=t.urls,o=t.paths,l=this.state,c=l.text,s=l.error,u=l.initialText;return Object(Z.f)(b.a.Fragment,null,Object(Z.f)(Ue,{urls:i,paths:o,organization:a,project:n,onAddRule:this.handleAddRule.bind(this),disabled:r}),Object(Z.f)("div",{style:{position:"relative"},onKeyDown:function(t){t.metaKey&&"Enter"===t.key&&e.handleUpdateOwnership()}},Object(Z.f)(De,{placeholder:"#example usage\npath:src/example/pipeline/* person@sentry.io #infra\nurl:http://example.com/settings/* #product\ntags.sku_class:enterprise #enterprise",onChange:this.handleChange,disabled:r,value:c,spellCheck:"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"}),Object(Z.f)(ze,null,Object(Z.f)("div",null,this.parseError(s)),Object(Z.f)(Ie,null,Object(Z.f)(v.a,{size:"small",priority:"primary",onClick:this.handleUpdateOwnership,disabled:r||c===u},Object(w.b)("Save Changes"))))))}}]),n}(b.a.Component);Pe.displayName="OwnerInput";var ze=Object(f.a)("div",{target:"en3n9di0",label:"ActionBar"})({name:"1lekzkb",styles:"display:flex;align-items:center;justify-content:space-between;"}),Ae=Object(f.a)("div",{target:"en3n9di1",label:"SyntaxOverlay"})(C.a,";width:100%;height:",24,"px;background-color:red;opacity:0.1;pointer-events:none;position:absolute;top:",(function(e){return 4+24*e.line}),"px;"),Ie=Object(f.a)("div",{target:"en3n9di2",label:"SaveButton"})({name:"1lifesv",styles:"text-align:end;padding-top:10px;"}),De=Object(f.a)(m.a,{target:"en3n9di3",label:"StyledTextArea"})(C.a,";min-height:140px;overflow:auto;outline:0;width:100%;resize:none;margin:0;font-family:",(function(e){return e.theme.text.familyMono}),";word-break:break-all;white-space:pre-wrap;padding-top:",4,"px;line-height:",24,"px;"),Ne=Object(f.a)("div",{target:"en3n9di4",label:"InvalidOwners"})("color:",(function(e){return e.theme.error}),";font-weight:bold;margin-top:12px;");t.a=Pe}}]);
//# sourceMappingURL=CreateOwnershipRuleModal~ProjectOwnership.js.map