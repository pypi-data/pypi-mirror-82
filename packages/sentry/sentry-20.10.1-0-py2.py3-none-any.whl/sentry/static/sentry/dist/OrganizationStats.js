(window.sntryWpJsonp=window.sntryWpJsonp||[]).push([[133],{2912:function(t,e,r){"use strict";r.r(e),r.d(e,"OrganizationStatsContainer",(function(){return O}));var a=r(5),n=r.n(a),s=r(10),o=r.n(s),i=r(11),c=r.n(i),u=r(12),p=r.n(u),l=r(13),d=r.n(l),h=r(6),f=r.n(h),g=r(103),j=r.n(g),v=r(1),y=r.n(v),P=r(278),q=r.n(P),D=r(50),S=r(20),R=r(69),w=r(0);function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,a=f()(t);if(e){var n=f()(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return d()(this,r)}}var O=function(t){p()(a,t);var e=k(a);function a(t){var r;o()(this,a),r=e.call(this,t);var n=Math.floor((new Date).getTime()/1e3),s=n-604800;return r.state={projectsError:!1,projectsLoading:!1,projectsRequestsPending:0,statsError:!1,statsLoading:!1,statsRequestsPending:0,projectMap:null,rawProjectData:{received:null,rejected:null,blacklisted:null},rawOrgData:{received:null,rejected:null,blacklisted:null},orgStats:null,orgTotal:null,projectTotals:null,querySince:s,queryUntil:n},r}return c()(a,[{key:"UNSAFE_componentWillMount",value:function(){this.fetchData()}},{key:"UNSAFE_componentWillReceiveProps",value:function(t){t.location.search!==this.props.location.search&&this.setState({projectsError:!1,projectsRequestsPending:1,projectsLoading:!0})}},{key:"componentDidUpdate",value:function(t){var e=t.params,r=this.props.params;e.orgId!==r.orgId&&this.fetchData(),t.location.search!==this.props.location.search&&(window.scrollTo&&window.scrollTo(0,0),this.fetchProjectData());var a=this.state;a.statsLoading&&!a.statsRequestsPending&&this.processOrgData(),a.projectsLoading&&!a.projectsRequestsPending&&this.processProjectData()}},{key:"fetchProjectData",value:function(){var t=this;this.props.api.request(this.getOrganizationProjectsEndpoint(),{query:this.props.location.query,success:function(e,r,a){var n={};e.forEach((function(t){n[t.id]=t})),t.setState((function(t){return{pageLinks:a.getResponseHeader("Link"),projectMap:n,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})}},{key:"fetchData",value:function(){var t=this;this.setState({statsError:!1,statsLoading:!0,statsRequestsPending:3,projectsError:!1,projectsLoading:!0,projectsRequestsPending:4});var e=this.getOrganizationStatsEndpoint();j.a.each(this.state.rawOrgData,(function(r){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,resolution:"1h",stat:r},success:function(e){t.setState((function(t){var a=t.rawOrgData;return a[r]=e,{rawOrgData:a,statsRequestsPending:t.statsRequestsPending-1}}))},error:function(){t.setState({statsError:!0})}})})),j.a.each(this.state.rawProjectData,(function(r){t.props.api.request(e,{query:{since:t.state.querySince,until:t.state.queryUntil,stat:r,group:"project"},success:function(e){t.setState((function(t){var a=t.rawProjectData;return a[r]=e,{rawProjectData:a,projectsRequestsPending:t.projectsRequestsPending-1}}))},error:function(){t.setState({projectsError:!0})}})})),this.fetchProjectData()}},{key:"getOrganizationStatsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/stats/"}},{key:"getOrganizationProjectsEndpoint",value:function(){return"/organizations/"+this.props.params.orgId+"/projects/"}},{key:"processOrgData",value:function(){var t=0,e=0,r=0,a=[],n=[0,0],s=this.state.rawOrgData;j.a.each(s.received,(function(o,i){var c=i[1],u=s.rejected[o][1],p=s.blacklisted[o][1],l=Math.max(0,c-u-p);a.push({x:i[0],y:[l,u,p]}),t+=c,e+=u,r+=p,c>0&&(n[0]+=c,n[1]+=1)})),this.setState({orgStats:a,orgTotal:{received:t,rejected:e,blacklisted:r,accepted:Math.max(0,t-e-r),avgRate:n[1]?parseInt(n[0]/n[1]/60,10):0},statsLoading:!1})}},{key:"processProjectData",value:function(){var t=this.state.rawProjectData,e=[];j.a.each(t.received,(function(r,a){var n=0,s=0,o=0;j.a.each(a,(function(e,a){n+=a[1],s+=t.rejected[r][e][1],o+=t.blacklisted[r][e][1]})),e.push({id:r,received:n,rejected:s,blacklisted:o,accepted:Math.max(0,n-s-o)})})),this.setState({projectTotals:e,projectsLoading:!1})}},{key:"render",value:function(){var t=this.props.organization;return Object(w.f)(q.a,{title:"Stats - ".concat(t.slug," - Sentry")},Object(w.f)(S.a,n()({component:function(){return r.e(219).then(r.bind(null,2825)).then((function(t){return t.default}))},organization:t},this.state)))}}]),a}(y.a.Component);O.displayName="OrganizationStatsContainer",e.default=Object(D.a)(Object(R.a)(O))}}]);
//# sourceMappingURL=OrganizationStats.js.map