
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial &#8212; SLEPc for Python 3.14.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="install.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SLEPc for Python 3.14.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tutorial</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial is intended for basic use of slepc4py. For more advanced
use, the reader is referred to SLEPc tutorials as well as to slepc4py
reference documentation.</p>
<div class="section" id="commented-source-of-a-simple-example">
<h2>Commented source of a simple example<a class="headerlink" href="#commented-source-of-a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>In this section, we include the source code of example <code class="docutils literal notranslate"><span class="pre">demo/ex1.py</span></code>
available in the slepc4py distribution, with comments inserted inline.</p>
<p>The first thing to do is initialize the libraries. This is normally
not required, as it is done automatically at import time. However, if
you want to gain access to the facilities for accesing command-line
options, the following lines must be executed by the main script prior
to any petsc4py or slepc4py calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">slepc4py</span>
<span class="n">slepc4py</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we have to import the relevant modules. Normally, both PETSc and
SLEPc modules have to be imported in all slepc4py programs. It may be
useful to import NumPy as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">petsc4py</span> <span class="k">import</span> <span class="n">PETSc</span>
<span class="kn">from</span> <span class="nn">slepc4py</span> <span class="k">import</span> <span class="n">SLEPc</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
<p>At this point, we can use any petsc4py and slepc4py operations. For
instance, the following lines allow the user to specify an integer
command-line argument <code class="docutils literal notranslate"><span class="pre">n</span></code> with a default value of 30 (see the next
section for example usage of command-line options):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opts</span> <span class="o">=</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">Options</span><span class="p">()</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>It is necessary to build a matrix to define an eigenproblem (or two in
the case of generalized eigenproblems). The following fragment of code
creates the matrix object and then fills the non-zero elements one by
one. The matrix of this particular example is tridiagonal, with value
2 in the diagonal, and -1 in off-diagonal positions. See petsc4py
documentation for details about matrix objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">Mat</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">A</span><span class="o">.</span><span class="n">setSizes</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">])</span>
<span class="n">A</span><span class="o">.</span><span class="n">setFromOptions</span><span class="p">()</span>
<span class="n">A</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

<span class="n">rstart</span><span class="p">,</span> <span class="n">rend</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">getOwnershipRange</span><span class="p">()</span>

<span class="c1"># first row</span>
<span class="k">if</span> <span class="n">rstart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rstart</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c1"># last row</span>
<span class="k">if</span> <span class="n">rend</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
    <span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">rend</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="c1"># other rows</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rstart</span><span class="p">,</span> <span class="n">rend</span><span class="p">):</span>
    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">A</span><span class="o">.</span><span class="n">assemble</span><span class="p">()</span>
</pre></div>
</div>
<p>The solver object is created in a similar way as other objects in
petsc4py:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">SLEPc</span><span class="o">.</span><span class="n">EPS</span><span class="p">();</span> <span class="n">E</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
<p>Once the object is created, the eigenvalue problem must be
specified. At least one matrix must be provided. The problem type must
be indicated as well, in this case it is HEP (Hermitian eigenvalue
problem). Apart from these, other settings could be provided here (for
instance, the tolerance for the computation). After all options have
been set, the user should call the <code class="docutils literal notranslate"><span class="pre">setFromOptions()</span></code> operation, so
that any options specified at run time in the command line are passed
to the solver object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">.</span><span class="n">setOperators</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="n">E</span><span class="o">.</span><span class="n">setProblemType</span><span class="p">(</span><span class="n">SLEPc</span><span class="o">.</span><span class="n">EPS</span><span class="o">.</span><span class="n">ProblemType</span><span class="o">.</span><span class="n">HEP</span><span class="p">)</span>
<span class="n">E</span><span class="o">.</span><span class="n">setFromOptions</span><span class="p">()</span>
</pre></div>
</div>
<p>After that, the <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method will run the selected eigensolver,
keeping the solution stored internally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
<p>Once the computation has finished, we are ready to print the results.
First, some informative data can be retrieved from the solver object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Print</span> <span class="o">=</span> <span class="n">PETSc</span><span class="o">.</span><span class="n">Sys</span><span class="o">.</span><span class="n">Print</span>

<span class="n">Print</span><span class="p">()</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;******************************&quot;</span><span class="p">)</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;*** SLEPc Solution Results ***&quot;</span><span class="p">)</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;******************************&quot;</span><span class="p">)</span>
<span class="n">Print</span><span class="p">()</span>

<span class="n">its</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getIterationNumber</span><span class="p">()</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;Number of iterations of the method: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">its</span><span class="p">)</span>

<span class="n">eps_type</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;Solution method: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">eps_type</span><span class="p">)</span>

<span class="n">nev</span><span class="p">,</span> <span class="n">ncv</span><span class="p">,</span> <span class="n">mpd</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">()</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;Number of requested eigenvalues: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nev</span><span class="p">)</span>

<span class="n">tol</span><span class="p">,</span> <span class="n">maxit</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getTolerances</span><span class="p">()</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;Stopping condition: tol=</span><span class="si">%.4g</span><span class="s2">, maxit=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tol</span><span class="p">,</span> <span class="n">maxit</span><span class="p">))</span>
</pre></div>
</div>
<p>For retrieving the solution, it is necessary to find out how many
eigenpairs have converged to the requested precision:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nconv</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getConverged</span><span class="p">()</span>
<span class="n">Print</span><span class="p">(</span><span class="s2">&quot;Number of converged eigenpairs </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">nconv</span><span class="p">)</span>
</pre></div>
</div>
<p>For each of the <code class="docutils literal notranslate"><span class="pre">nconv</span></code> eigenpairs, we can retrieve the eigenvalue
<code class="docutils literal notranslate"><span class="pre">k</span></code>, and the eigenvector, which is represented by means of two
petsc4py vectors <code class="docutils literal notranslate"><span class="pre">vr</span></code> and <code class="docutils literal notranslate"><span class="pre">vi</span></code> (the real and imaginary part of the
eigenvector, since for real matrices the eigenvalue and eigenvector
may be complex).  We also compute the corresponding relative errors in
order to make sure that the computed solution is indeed correct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">nconv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># Create the results vectors</span>
    <span class="n">vr</span><span class="p">,</span> <span class="n">wr</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">getVecs</span><span class="p">()</span>
    <span class="n">vi</span><span class="p">,</span> <span class="n">wi</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">getVecs</span><span class="p">()</span>
    <span class="c1">#</span>
    <span class="n">Print</span><span class="p">()</span>
    <span class="n">Print</span><span class="p">(</span><span class="s2">&quot;        k          ||Ax-kx||/||kx|| &quot;</span><span class="p">)</span>
    <span class="n">Print</span><span class="p">(</span><span class="s2">&quot;----------------- ------------------&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nconv</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">getEigenpair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">vr</span><span class="p">,</span> <span class="n">vi</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">computeError</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">imag</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">Print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%9f%+9f</span><span class="s2"> j </span><span class="si">%12g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%12f</span><span class="s2">      </span><span class="si">%12g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">error</span><span class="p">))</span>
    <span class="n">Print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="example-of-command-line-usage">
<h2>Example of command-line usage<a class="headerlink" href="#example-of-command-line-usage" title="Permalink to this headline">¶</a></h2>
<p>Now we illustrate how to specify command-line options in order to
extract the full potential of slepc4py.</p>
<p>A simple execution of the <code class="docutils literal notranslate"><span class="pre">demo/ex1.py</span></code> script will result in the
following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python demo/ex1.py

******************************
*** SLEPc Solution Results ***
******************************

Number of iterations of the method: 4
Solution method: krylovschur
Number of requested eigenvalues: 1
Stopping condition: tol=1e-07, maxit=100
Number of converged eigenpairs 4

    k          ||Ax-kx||/||kx||
----------------- ------------------
     3.989739        5.76012e-09
     3.959060        1.41957e-08
     3.908279        6.74118e-08
     3.837916        8.34269e-08
</pre></div>
</div>
<p>For specifying different setting for the solver parameters, we can use
SLEPc command-line options with the <code class="docutils literal notranslate"><span class="pre">-eps</span></code> prefix. For instance, to
change the number of requested eigenvalues and the tolerance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python demo/ex1.py -eps_nev 10 -eps_tol 1e-11
</pre></div>
</div>
<p>The method used by the solver object can also be set at run time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python demo/ex1.py -eps_type lanczos
</pre></div>
</div>
<p>All the above settings can also be change within the source code by
making use of the appropriate slepc4py method. Since options can be
set from within the code and the command-line, it is often useful to
view the particular settings that are currently being used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python demo/ex1.py -eps_view

EPS Object: 1 MPI processes
  type: krylovschur
    Krylov-Schur: 50% of basis vectors kept after restart
  problem type: symmetric eigenvalue problem
  selected portion of the spectrum: largest eigenvalues in magnitude
  number of eigenvalues (nev): 1
  number of column vectors (ncv): 16
  maximum dimension of projected problem (mpd): 16
  maximum number of iterations: 100
  tolerance: 1e-08
  convergence test: relative to the eigenvalue
BV Object: 1 MPI processes
  type: svec
  17 columns of global length 30
  orthogonalization method: classical Gram-Schmidt
  orthogonalization refinement: if needed (eta: 0.7071)
DS Object: 1 MPI processes
  type: hep
  solving the problem with: Implicit QR method (_steqr)
ST Object: 1 MPI processes
  type: shift
  shift: 0
  number of matrices: 1
</pre></div>
</div>
<p>Note that for computing eigenvalues of smallest magnitude we can use
the option <code class="docutils literal notranslate"><span class="pre">-eps_smallest_magnitude</span></code>, but for interior eigenvalues
things are not so straightforward. One possibility is to try with
harmonic extraction, for instance to get the eigenvalues closest to
0.6:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python demo/ex1.py -eps_harmonic -eps_target 0.6
</pre></div>
</div>
<p>Depending on the problem, harmonic extraction may fail to converge. In
those cases, it is necessary to specify a spectral transformation
other than the default. In the command-line, this is indicated with
the <code class="docutils literal notranslate"><span class="pre">-st_</span></code> prefix. For example, shift-and-invert with a value of the
shift equal to 0.6 would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python demo/ex1.py -st_type sinvert -eps_target 0.6
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#commented-source-of-a-simple-example">Commented source of a simple example</a></li>
<li><a class="reference internal" href="#example-of-command-line-usage">Example of command-line usage</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="install.html"
                        title="next chapter">Installation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SLEPc for Python 3.14.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tutorial</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Lisandro Dalcin.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>