{% extends 'base.html' %}

{% block header %}
    <div class="jumbotron" style="margin-bottom:0">
        <div class="fa-pull-right text-right">
            <a href="{{ url_for('project.export_as_excel', project_id=project['id']) }}" class="btn btn-success btn-lg mb-1"><i class="fas fa-file-excel"></i> Export</a><br/>
            <a href="{{ url_for('project.details', project_id=project['id']) }}" class="btn btn-info btn-lg"><i class="fas fa-chart-line"></i> Zum technischen Dashboard</a>
        </div>
        <h1 class="display-3">{% block title %}Projektdetails{% endblock %}</h1>

          <div class=" lead text-left">
              <strong>Name: </strong>{{ project["name"] }}<br/>
              <strong>Beschreibung: </strong>{{ project["description"] }}<br/>
              {% if project["start_date"] is defined %}
                <strong>Startdatum: </strong>{{ project["start_date"] }}<br/>
              {% endif %}
              {% if project["end_date"] is defined %}
                <strong>Enddatum: </strong>{{ project["end_date"] }}
              {% endif %}
          </div>


    </div>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-12">
            <canvas id="project_fulfilment_chart" width="1024px"></canvas>

            <script>
                var ctx = document.getElementById('project_fulfilment_chart').getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'bubble',
                    // The data for our dataset
                        data: {
                            datasets: [
                                {% for cd in chart_data %}
                                    {
                                        label: '{{ cd['label'] }}',
                                        backgroundColor: '{{ cd['bgColor'] }}',
                                        borderColor: '#fff',
                                        data: [{x: {{ cd['x'] }}, y: {{ cd['y'] }}, r: {{ cd['r'] }}}],
                                    },
                                {% endfor %}
                                ]

                            //#63ace5
                        },

                        // Configuration options go here
                        options: {
                          scales: {
                            yAxes: [{
                                type: 'linear',
                                ticks: {
                                    beginAtZero: true,
                                    max:100,
                                    min: 0
                                },
                                offset: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: "Tech/Org Gegenmaßnahmen (%)",
                                    fontSize: 20
                                },
                            }],
                            xAxes: [{
                                type: 'linear',
                                ticks: {
                                    beginAtZero: true,
                                    max:100,
                                    min: 0
                                },
                                offset: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: "Awarenessmaßnahmen (%)",
                                    fontSize: 20
                                },
                            }]
                          },
                          legend: {
                            display: true,
                          },
                            tooltips: {
                              callbacks: {
                                    label: function(tooltipItem, data) {
                                        return data.datasets[tooltipItem.datasetIndex].label + ':';
                                    },
                                    afterLabel: function(tooltipItem, data) {
                                        var label = [];
                                        label.push('    Awarenessmaßnahmen (%): ' + tooltipItem.xLabel);
                                        label.push('    Gegenmaßnahmen (%): ' + tooltipItem.yLabel);
                                        return label;
                                    }
                                }
                            }
                        }
                    });
            </script>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-12 mb-3">
            <h2 class="display-4">Awareness Planung</h2>
            <hr>
        </div>
        <div class="col-6">
            <h4>Vergangenheit</h4>
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Beschreibung</th>
                  <th scope="col">Geplant für</th>
                </tr>
              </thead>
              <tbody>
                {% for am in awarenessmeasures_past %}
                  <tr>
                      <td>{{ am['name'] if am is defined and am['name'] is defined }}</td>
                      <td>{{ am['description'] if am is defined and am['description'] is defined }}</td>
                      <td>{{ am['due_date'].strftime("%d.%m.%Y") if am['due_date'] is defined and am['due_date'] is not none }}</td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
        </div>
        <div class="col-6">
            <h4>dieser Monat</h4>
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Beschreibung</th>
                  <th scope="col">Geplant für</th>
                </tr>
              </thead>
              <tbody>
                {% for am in awarenessmeasures_this_month %}
                  <tr>
                      <td>{{ am['name'] if am is defined and am['name'] is defined }}</td>
                      <td>{{ am['description'] if am is defined and am['description'] is defined }}</td>
                      <td>{{ am['due_date'].strftime("%d.%m.%Y") if am['due_date'] is defined and am['due_date'] is not none }}</td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-6">
            <h4>nächster Monat</h4>
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Beschreibung</th>
                  <th scope="col">Geplant für</th>
                </tr>
              </thead>
              <tbody>
                {% for am in awarenessmeasures_next_month %}
                  <tr>
                      <td>{{ am['name'] if am is defined and am['name'] is defined }}</td>
                      <td>{{ am['description'] if am is defined and am['description'] is defined }}</td>
                      <td>{{ am['due_date'].strftime("%d.%m.%Y") if am['due_date'] is defined and am['due_date'] is not none }}</td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
        </div>
        <div class="col-6">
            <h4>ohne Datum</h4>
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Beschreibung</th>
                </tr>
              </thead>
              <tbody>
                {% for am in awarenessmeasures_without_date %}
                  <tr>
                      <td>{{ am['name'] if am is defined and am['name'] is defined }}</td>
                      <td>{{ am['description'] if am is defined and am['description'] is defined }}</td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col-6">
            <h4>Rechtliche Abklärung</h4>
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Beschreibung</th>
                  <th scope="col">rechtliche Beschreibung</th>
                </tr>
              </thead>
              <tbody>
                {% for am in awarenessmeasures_with_legal_attention %}
                  <tr>
                      <td>{{ am['name'] if am is defined and am['name'] is defined }}</td>
                      <td>{{ am['description'] if am is defined and am['description'] is defined }}</td>
                      <td>{{ am['legal_description'] if am is defined and am['legal_description'] is defined }}</td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
        </div>
    </div>
{% endblock %}
