dist: xenial
language: python
python:
- '3.6'
- '3.7'

before_install:
- sudo apt-get install -y npm keyutils
- npm install -g @bitwarden/cli
- export SESSION_KEY="$(bw login ${BITWARDEN_EMAIL} ${BITWARDEN_PASSWORD} --raw)"
- echo ${SESSION_KEY} | keyctl padd user bw_session @u

install:
- pip install -e .

script:
- python setup.py test

deploy:
- provider: pypi
  distributions: "sdist bdist_wheel"
  skip_existing: true
  on:
    tags: true
  user: "remyrd"
  password:
    secure: "dofEQ5ZDRgLqemj3MPiDu5b4I1yPitvEXlMEsTbNpG4vLzk/BjHZbZrOIvnt2JLwGC69eRDQ+G0TySZo8pNffH0wYfVCXCBRrS80LNNnvU6c3se/3HCTUSS+ObdplQZU8Ym+nZn0fF9hx/mCNpb157i1mzdfEzJTmo+H1uW2YAC9u44pvM4J5nGi3zqobkv8BXychAf+3bnuoAlDpGREGEsDQ41bGgYn0HesgSjASeFBKJKKvrGv6NOYNPzUmzJgWmp76Xji8V5i1ttTVKq/uwgIYziz9UziRqPADgxCDxhRP8tqjFkOsLK3BoROWSCrr9gbdkcasGosEUmlis7j9jkCMEYBF1wHzNuhRa0yh0czwCgdPFTY5r5O/ilSW0SZ22rCoV7FY+b/PD/4IsYzWddvYe76H0hF3PFqjIjm//sCQtbsMT/uYewwrR4PT7/WP+39+VRvQ2WDHfgyKswkKcxLDCfzr4VDWQZn4NsyWfCWGmiOYt1H5/930tOPK8GVOyKmJM9lMjCJufQPCRFQakztAw8AUC6xsxl8vXmNRNnzdYUONX8mo2UVX9t/A9kTuDFpG/sQk6qNWp/Fuk/I0d44oqYY/9hppwKy53fXCW7SDy2TVVwLctozEr9zPYU0aqSRgc69gBl8qggt9KVlNMreNh9qTIJfamhFYz4IZ64="
- provider: pypi
  distributions: "sdist bdist_wheel"
  skip_existing: "true"
  server: https://test.pypi.org/legacy/
  on:
    all_branches: true
  user: "remyrd"
  password:
    secure: "GN0h0DQMTmnAathxmpzy2QdOv40PVIbyopZxhi6sMG0y+ihSOMseqkdRO5AvEyz5GUYj+7V/O3hqoiCvRZCJOT8MnLztn9jcS5AEIX1SIRGn7PchdTOScssyT3CZdi9pKjfQcrybEinLdZ9LL5nc5lzxVyk9J71jo0+VHHl8cSQG79NB9y67N6T18pmR7Xd7GKQmw+gxxP9xuV/k/v0xUTvYFA7oHdIhnwrXEDIPyyrNcB5JfgUJgWZvQeDFpzOeu8vBBgTk+grmarsqTu9N8HGsTmpl6i7cO7lhY/KUwFKA80az2M57yRoImU2biF2GfAKBd+xhEGKfhEh6ePYXd4w6DCsPzISlyrERoGRuVW/MhRrgzAP/0mDTontpavmC/+ix7ghxVZfwHLTIX/Xvj7ovbjRB/fSCNrDL1oEWunILzqIgdorM6nIPoLPCBubF2V8CByYCzRgCSFiYJpZ9gwi8NLHKFUP1jUo9P2JG/ho9RTQ3Iz8LTXFyo3q2n/yledZKs8lFlzoeYIisaVD2zz8osmTDVvAx//Dzwf9/0d14W6gsQfGEiLlFIwGmEjX6cS5+q3SO2MT1qllE8bEPH1xVu8YOsfev9EFz2qnZlG7gNX0s7frx73TfThJwxZXCxmkT0Eh4GP9bDbSVYwzNdzVkUvyKfHyn7Mjr4Pr1cGQ="

env:
  global:
  - secure: XxDNTAJdnUaj9FdA9cXSSsArUO+ga7LWKbFnYo8p7eRW667EuC3oE01mMa0CGC73ZwgLdLb12sF/eeV5ypC1kuzACAguZen+X/k0cEjSSf2ZOtbnRLQFuHmRKehnna4HGSpMjG428rGASF1iYyr4VqMWngA/Lz17W3rcnlNirTCZJen9QrCrPNrGcHf+uYJhCT4f8qaQbrn0CqzSIG1jhEtgvkdRo5u4CmdScP2B36wMYzxjW6HdppV7Q+cpMeBdsUrocjnPfZIDhLs97WDr4rmPc43r8eMEpHnhNVbIHNsoPtKClv6pGO3jiRUGq6FuVi6u0wEf2QlGrNG9hc1PFt3va7qh7bE++t7AmKjbGjpdFVjqP3KKWYohctaMOZQS+qGZi14GVuv6i0TiB6j7GA3EvzVpn96b7ryUaCcIf3S2vj6G6TNVDg+9WTm0BYT2rj6qikXAcl9g/+2MgotTLj0W1tjJ1AXCaT/NHRb3YKhdh0AGBdFei5PFLRj0UGxCF09xkzODyodFmp0qqXStXegDWmE7CXStQ8cpHUTgFPuUBmZ0OigulwsL1nbqLyBfzb8cfGnhSsMxCdMjpJYI2T8TTRZt+9Z60MC4fZWKQKryXnVgt2sWNSdA6vvi4Qo+Zfp/o32SsCi4fuet2gBE7Nuu6r1ReygChXlnMbzUSV4=
  - secure: AdGwA4HIZuHsOeAfHMKXPwTJMYbqjuQqP4TSyRGcDvsX3lwbg7A/wYwnnfSi649wARoguJdrAl5shNrdgs34QO56QINRr8rcaGO8+15jjcCcbBW2ZkzchJGmwVm+0+YgOt4t6RGZp6M3AUQgOTw7Rq3EeZaGtf8l3s4pi3IZmNcMnmcYlO9vWkA8XgW0ieI5fKmSgAI8l9lvdZiJUTkJZDjcB9Gci21QC6cYu0S7JsGjJg5U9sm3JCn0Aw9r1TuO8oJplk3zb8qpcpl/VzMrele0/3o3u1KV4CfJM8S7XHShUfPzM2ZXRGi8aIJLYuTueGElhdPLvx2SuujMdGs0BP4apFbI4FXmJvjqFUdUQUDvt8ulQWy3SzeXdQlNIpR1qb6XYFZldqmdrWNTjyeSf9Cyl+CdyOFBXlpM/NQHCYuZ8dIec7rngW4mwJcCg5ADaRj/9dQblsSBVNRt8ZMWAr26po7NKBVk9V6PWkVuHWkgFHngOVm1Y6o14NBbIO6c4tC1yvoNU0TRmcd3U+VKcZF6BDW0PhUw3/Ltw+wOE6AMtbOaMwLW4RVTAZ96ugTAEj4VmISkE5ixmHkLYjlIxF9xPuRPm3l1lWnnHGwGyu0fh0slsz3ddbO+EoiO71qEQ5znGqKeABuGBPdW7WIAY85N59lL9Wy6HhvF85roePY=
