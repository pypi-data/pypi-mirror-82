!function(t){var n={};function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(o,i,function(n){return t[n]}.bind(null,i));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/++plone++senaite.storage.static/bundles",e(e.s=3)}([function(t,n){t.exports=jQuery},function(t,n,e){"use strict";(function(t){var e,o=function(t,n){return function(){return t.apply(n,arguments)}};e=function(){function n(){return this.debug=o(this.debug,this),this.on_position_slot_click=o(this.on_position_slot_click,this),this.on_position_change=o(this.on_position_change,this),this.bind_eventhandler=o(this.bind_eventhandler,this),console.debug("StoreContainerController::init"),this.bind_eventhandler(),t("#position").change(),this}return n.prototype.bind_eventhandler=function(){return this.debug("StoreContainerController::bind_eventhandler"),t("body").on("click","a.position_slot_selector",this.on_position_slot_click),t("body").on("change","#position",this.on_position_change)},n.prototype.on_position_change=function(n){var e;return this.debug("StoreContainerController::on_position_change"),e=t(n.currentTarget),t("td.empty-slot").removeClass("selected"),t("#"+e.val()).parent("td.empty-slot").addClass("selected")},n.prototype.on_position_slot_click=function(n){var e;if(this.debug("StoreContainerController::on_position_slot_click"),n.preventDefault(),e=t(n.currentTarget),t("#position").val(e.attr("id")),t("#position").change(),t("#sample_uid").val())return t("#button_store").click()},n.prototype.debug=function(t){return console.debug("[senaite.storage] "+t)},n}(),n.a=e}).call(this,e(0))},function(t,n,e){"use strict";(function(t){var e,o=function(t,n){return function(){return t.apply(n,arguments)}};e=function(){function n(){return this.debug=o(this.debug,this),this.get_portal_url=o(this.get_portal_url,this),this.ajax_submit=o(this.ajax_submit,this),this.fetch_available_positions=o(this.fetch_available_positions,this),this.get_selected_positions=o(this.get_selected_positions,this),this.diff=o(this.diff,this),this.fill_container_positions=o(this.fill_container_positions,this),this.get_container_position_selects=o(this.get_container_position_selects,this),this.purge_container_position=o(this.purge_container_position,this),this.add_container_position=o(this.add_container_position,this),this.on_container_position_change=o(this.on_container_position_change,this),this.on_container_change=o(this.on_container_change,this),this.bind_eventhandler=o(this.bind_eventhandler,this),console.debug("StoreSamplesController::init"),this.bind_eventhandler(),this}return n.prototype.bind_eventhandler=function(){return this.debug("StoreSamplesController::bind_eventhandler"),t("body").on("selected",".ArchetypesReferenceWidget input",this.on_container_change),t("body").on("change","select[name='samples\\.container_position:records']",this.on_container_position_change)},n.prototype.on_container_change=function(n){var e,o,i,r;this.debug("StoreSamplesController::on_container_change"),o=(e=t(n.currentTarget)).attr("uid"),i=e.attr("sample_uid"),r=t("#container_position\\."+i+"_uid")[0],this.fill_container_positions(o,r)},n.prototype.on_container_position_change=function(n){var e,o,i,r;if(this.debug("StoreSamplesController::on_container_position_change"),(e=(r=t(n.currentTarget)).attr("container_uid"))&&(i=r.val(),this.purge_container_position(e,i),o=r.attr("original_value"),t(r).attr("original_value",i),o))return this.add_container_position(e,o)},n.prototype.add_container_position=function(n,e){var o;this.debug("StoreSamplesController::add_container_position:container_uid="+n+", position="+e),o=this.get_container_position_selects(n),t.each(o,(function(n,o){var i,r,s;if(i=t(o).find("option"),s=t(i).map((function(){return t(this).val()})),!((s=t.makeArray(s)).indexOf(e)>=0))return s.push(e),s.sort(),r=t(o).val(),t(o).find("option").remove(),t.each(s,(function(n,e){return t(o).append(new Option(e,e))})),t(o).val(r)}))},n.prototype.purge_container_position=function(n,e){var o;this.debug("StoreSamplesController::purge_container_position:container_uid="+n+", position="+e),o=this.get_container_position_selects(n),t.each(o,(function(n,o){if(t(o).val()!==e)return t(o).find("option[value='"+e+"']").remove()}))},n.prototype.get_container_position_selects=function(n){return this.debug("StoreSamplesController::get_container_position_selects:container_uid="+n),"samples\\.container_position:records",t("select[name='samples\\.container_position:records'][container_uid='"+n+"']")},n.prototype.fill_container_positions=function(n,e){this.debug("StoreSamplesController::fill_container_positions:container_uid="+n),t(e).find("option").remove(),t(e).attr("original_value",""),t(e).attr("container_uid",n),this.fetch_available_positions(n).done((function(o){var i,r,s,a,l;for(l=this.get_selected_positions(n),r=0,s=(i=this.diff(o,t.makeArray(l))).length;r<s;r++)a=i[r],t(e).append(new Option(a,a));t(e).val(i[0]),t(e).trigger("change")})).fail((function(){console.warn("Failed to get available positions")}))},n.prototype.diff=function(t,n){return t.concat(n).filter((function(t,n,e){return e.indexOf(t)===e.lastIndexOf(t)}))},n.prototype.get_selected_positions=function(n){var e;return e=this.get_container_position_selects(n),t(e).map((function(){return t(this).val()}))},n.prototype.fetch_available_positions=function(n){var e;return e=t.Deferred(),"AvailablePositions",this.ajax_submit({url:this.get_portal_url()+"/@@API/read",data:{catalog_name:"uid_catalog",UID:n,include_fields:["AvailablePositions"]}}).done((function(t){return e.resolveWith(this,[t.objects[0].AvailablePositions])})),e.promise()},n.prototype.ajax_submit=function(n){var e;return null==n&&(n={}),null==n.type&&(n.type="POST"),null==n.url&&(n.url=this.get_portal_url()),null==n.context&&(n.context=this),null==n.dataType&&(n.dataType="json"),null==n.data&&(n.data={}),this.debug("ajax_submit::options=",n),t(this).trigger("ajax:submit:start"),e=function(){return t(this).trigger("ajax:submit:end")},t.ajax(n).done(e)},n.prototype.get_portal_url=function(){return t("input[name=portal_url]").val()||window.portal_url},n.prototype.debug=function(t){return console.debug("[senaite.storage] "+t)},n}(),n.a=e}).call(this,e(0))},function(t,n,e){e(4),t.exports=e(5)},function(t,n,e){"use strict";e.r(n);var o=e(1),i=e(2);document.addEventListener("DOMContentLoaded",(function(){console.debug("*** SENAITE STORAGE JS LOADED ***");var t=document.body.classList;t.contains("template-storage_store_container")&&(window.store_container_controller=new o.a),t.contains("template-storage_store_samples")&&(window.store_samples_controller=new i.a)}))},function(t,n,e){}]);